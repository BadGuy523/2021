### 消息队列（消息中间件）
- 用高效可靠的消息传递机制进行与平台无关的数据交流，基于数据通信来进行分布式系统的集成。通过提供消息传递和消息队列模型，可以再分布式环境下扩展进程的通信
### MQ特点
1. 是一个独立运行的服务。生产者发送消息，消费者接受消息，需要先跟服务器建立连接
2. 采用队列作为数据结构，有先进先出的特点
3. 具有发布订阅的模型，消费者可以获取自己需要的消息
### 使用场景
1. 异步通信
- 对于数据量大或者处理耗时长的操作，我们可以引入MQ实现异步通信，减少客户端的等待，提升响应速度，优化客户体验
2. 系统解耦
- 对于改动影响大的系统之间，可以引入MQ实现解耦，减少系统之间的直接依赖，提升可维护性和可扩展性
3. 流量削峰
- 对于会出现瞬间的流量峰值的系统，我们可以引入MQ实现流量削峰，达到保护应用和数据库的目的
4. 广播通信
- 一对多的广播通信
### 使用消息队列带来的一些问题
- 运维成本的增加，需要资源部署，还要保证它时刻正常运行
- 系统可用性降低，原来是两个节点通信，现在还需通过一个独立运行的服务中转，一旦网络或者独立服务出现问题，就会请求失败，影响业务
- 系统复杂性提高，要使用MQ，就需要学习成本，并保证正确配置和使用MQ，需考虑消息丢失和消息重复消费的问题，保证数据一致性
### AMQP（Advanced Message Queuing Protocol - 高级消息队列协议）
- 本质上是一种进程间传递异步消息的网络协议。它是跨语言和平台的，工作于应用层的协议
### RabbitMQ
- 开发语言为Erlang语言，是为电话交换机编写的语言，天生适合分布式和高并发
##### Broker
- RabbitMQ的服务器我们把它叫做Broker，中文翻译是代理/中介，MQ服务器帮助我们做的事情就是存储，转发消息
##### Connection
- 无论是生产者发送消息，还是消费者接受消息，都必须跟Broker之间建立一个连接，这个连接是一个TCP的长连接
##### Channel
- 如果所有生产者发送消息和消费者接受消息，都直接创建和释放TCP长连接的话，对于Broker肯定会造成很大的性能损耗
- 所以引入了Channel的概念，它是一个虚拟的连接，称为消息信道，我们可以在一个TCP长连接中创建和释放Channel，大大减少了资源消耗
- 不同的Channel是相互隔离的，每个Channel有自己的编号，对于每个客户端线程来说，Channel就没必要共享了，各自用自己的Channel
- Channel是RabbitMQ原生API里面的最重要的编程接口，我们定义交换机，队列，绑定关系，发送消息，消费消息，调用的都是Channel接口上的方法
##### Queue
- 在Broker上有一个对象用来存储消息，在RabbitMQ中这个对象就叫Queue，实际上RabbitMQ是用数据库来存储消息的，这个数据库也是用Erlang开发的，磁盘存储路径：C:\Users\用户名\AppData\Roaming\RabbitMQ\db\rabbit@用户名-mnesia
- 队列也是生产者和消费者的纽带，生产者发送的消息到达队列，在队列中存储。消费者从队列消费消息
##### Consumer
- Pull模式，对应方法为basicGet，消息存放在服务端，消费者主动获取才能拿到消息，缺点：消息的实时性会降低；优点：消费者可以根据自己的消费能力决定获取消息的频率
- Push模式，对应方法为basicConsume，消息一到服务器，就马上推送给消费者，消息保存在客户端，缺点：消费能力不够会造成消息积压；优点：实时性很高
- Spring AMQP是push方式，通过事件机制对队列进行监听，只要有消息到达队列，就会触发消费消息的方法
- RabbitMQ中pull和push都有实现，Kafka和RocketMQ只有pull
- 由于队列有FIFO的特性，只有确定前一条消息被消费者接受之后，Broker才会把这条消息从数据库删除，继续投递下一条消息
##### Exchange
- 如果把一条消息发送给多个队列，被多个消费者消费，生产者需要调用多次basicPublish方法，依次发送给多个队列，对生产者压力太大
- RabbitMQ中设计了一个帮我们路由消息的组件，叫做Exchange
- 生产者只需将消息发送给Exchange，它不会存储消息，只根据规则分发消息
- Exchange会和队列建立一个多对多的绑定关系
##### Vhost
- 不同的业务系统不想混用一个Broker，Vhost可以在同一个RabbitMQ服务中实现资源的隔离和权限的控制，类似编程语言中的namespace和package，不同的Vhost可以有同名的Exchange和Queue
- 我们安装RabbitMQ时会自带一个默认的Vhost，名字为“/”
##### 路由方式(四种类型的交换机-Exchange)
1. Direct(直连)
- 一个队列与直连交换机绑定，需指定一个明确的绑定键（binding key）
- 生产者发送消息时会携带一个路由键（routing key）
- 两者完全匹配时，消息才会从交换机路由到队列上
- 适合业务用途明确的消息
2. Topic（主题）
- 可以在绑定键中使用通配符，# 代表0个或者多个单词，* 代表一个单词
- 单词指的是用英文的.隔开的字符，如a.bc.def是3个单词
- 适用于一些根据业务主体或者消息等级过滤消息的场景
3. Fanout（广播）
- 不需要指定绑定键和路由键，所有与之绑定了的队列，都会收到相同消息的副本
- 适用于一些通用的业务消息
4. Headers()  
5. 
