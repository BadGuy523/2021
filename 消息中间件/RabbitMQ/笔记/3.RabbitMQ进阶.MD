## RabbitMQ进阶
### 案例-订单延时关闭
- 超过30分钟的未付款的订单自动关闭
- 思路：发送一条订单相关信息，30分钟后被消费，消费者查询是否付款，决定是否关闭
- rabbitMQ本身不支持消息延迟投递
- 方案1：存储到数据库，定时扫描（数据大时服务器压力过大）
- 方案2：利用RabbitMQ的死信队列（Dead Letter Queue）
###### 队列属性
- x-message-ttl:消息过期属性，所有队列中的消失超过时间未被消费，都会过期
###### 消息属性
- 在发送消息时通过MessageProperties指定消息属性
###### 死信
- 消息过期后没有任何配置，是会被直接丢弃的
- 可以通过配置让过期的消息编成死信
- 队列创建的时候可以指定一个死信交换机DLX（dead letter exchange），死信交换机绑定的队列称为死信队列DLQ（dead letter queue），其实就是普通的队列和普通的交换机，替补
- 如果消息过期了，队列指定了DLX，就会发送到DLX，如果DLX绑定了DLQ，路由到DLQ，消费者就可以绑定DLQ进行消费
###### 延时队列的其他实现
